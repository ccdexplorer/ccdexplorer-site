<script>
var commonTabulatorOptionsGET = {
    layout: "fitColumns",
    maxHeight: "400px",           // fixed outer height
    heightGrow: false, 
    responsiveLayout: "hide",
    paginationMode: "remote", 
    filterMode:"remote",
    sortMode:"remote",
    ajaxConfig: { method: "GET" },
    paginationSizeSelector: window["{{ccd_tabulator_table}}_size_selector"] || [10, 25, 50, 100, 500],
    paginationSize: (window["{{ccd_tabulator_table}}_size_selector"] || [10, 25, 50, 100, 500])[1],
    paginationButtonCount:3,
    pagination:true,
    paginationElement: document.getElementById("{{ccd_tabulator_table}}-paginator"),
    paginationCounter: function(pageSize, currentRow, currentPage, totalRows, totalPages) {
        // Humanize totals with Intl.NumberFormat compact notation
        function humanize(num) {
            if (num < 1000) {
                return num.toLocaleString();
            }
            return new Intl.NumberFormat('en', {
                notation: 'compact',
                compactDisplay: 'short',
                maximumFractionDigits: 1,
            }).format(num);
        }

        // Compute the 1-based range of items on this page
        if (totalRows === 0) {
            return `<span class="ccd">No Results</span>`;
        }

        const startIdx = (currentPage - 1) * pageSize + 1;
        const endIdx = Math.min(currentPage * pageSize, totalRows);
        const range = `${startIdx.toLocaleString()} â€“ ${endIdx.toLocaleString()}`;

        // Choose raw vs. humanized total
        const totalFmt = totalRows < 5000
            ? totalRows.toLocaleString()
            : humanize(totalRows);

        // Final display string
        return `<span class="ccd">${range} of ${totalFmt}</span>`;
    },
    
    ajaxURLGenerator: function (url, config, params) {
        const page = params.page || 1;
        const size = params.size || 10;
        const skip = (page - 1) * size;

        const sorter = params.sort?.[0] || {};
        const sort_key = sorter.field || window["{{ccd_tabulator_table}}_default_sort_field"];
        const direction = sorter.dir || window["{{ccd_tabulator_table}}_default_sort_field_direction"];
        const queryParams = {
            page,
            size,
        };
        if (window["{{ccd_tabulator_table}}_default_sort_field"] !== undefined) {
            queryParams.sort_key = sort_key;
            queryParams.direction = direction;
        }
        const query = new URLSearchParams(queryParams);
        return `${url}?${query.toString()}`;
    },
    
    rowFormatter: function(row){
        row.getElement().classList.add("sm-text");
    },
    
};
</script>