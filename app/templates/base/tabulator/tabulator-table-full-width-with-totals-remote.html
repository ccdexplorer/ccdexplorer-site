<div id="{{ccd_tabulator_table}}"></div>
<!-- <div>
  <a href="#" class="tabulator-download-button" id="download-csv">Download visible rows as CSV</a>
</div> -->

<script>
  
  window["{{ccd_tabulator_table}}_table"] = new Tabulator("#{{ccd_tabulator_table}}", {
      columns: window["{{ccd_tabulator_table}}_columns"],
      layout: "fitColumns",
      responsiveLayout: "hide",
      pagination: true, 
      paginationMode: "remote", 
      paginationSize: 10,
      paginationSizeSelector: [10, 25, 50, 100],
      paginationButtonCount:3,
      paginationCounter: "rows",
      sortMode:"remote",
      ajaxURL: "{{tabulator_ajax_url}}",
      initialSort:[
        {
          column: window["{{ccd_tabulator_table}}_default_sort_field"], 
          dir: window["{{ccd_tabulator_table}}_default_sort_field_direction"]
        }
        
    ],
    rowFormatter: function(row){
  row.getElement().classList.add("sm-text");
},
      ajaxURLGenerator: function (url, config, params) {
        const page = params.page || 1;
        const size = params.size || 10;
        const skip = (page - 1) * size;

        const sorter = params.sort?.[0] || {};
        const sort_key = sorter.field || window["{{ccd_tabulator_table}}_default_sort_field"];
        const direction = sorter.dir || window["{{ccd_tabulator_table}}_default_sort_field_direction"];
        console.log("sort_key", sort_key);
        const query = new URLSearchParams({
          page,
          size,
          sort_key,
          direction,
        });

        return `{{tabulator_ajax_url}}?${query.toString()}`;
      },

  });


</script>
