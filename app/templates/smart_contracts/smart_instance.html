{% extends "base/base.html" %}
{% block js %}
<script src="/node/plotly.js-strict-dist-min/plotly-strict.min.js"></script>
{% endblock %}
{% block content %}
<script>
    // async function getTokens(requested_page, total_rows) {
    //   tokens = document.getElementById('tokens');
    //   var address = document.getElementById('contract_id').title;
    //   url =  '/ajax_account_tokens/{{net}}/' + address + '/' + requested_page + '/' + total_rows + '/' + api_key;
    //   tokens.innerHTML = '{% include "base/spinner.html" %}'
    //   await fetch(url)
    //     .then((response) => {
    //       return response.text();
    //     })
    //     .then((data) => {
    //       tokens.innerHTML = data;
    //     })
    //     .catch(function (error) {
    //       console.log(error);
    //     });
    // }
  
    // function prev_v2_tokens(requested_page, total_rows) {
    //   getTokens(requested_page, total_rows)
    // };
    // function next_v2_tokens(requested_page, total_rows) {
    //   getTokens(requested_page, total_rows)
    // };
  
    // window.addEventListener('load', (event) => {
    // //   getTokens(0, 0);
    // });
  </script>
  
  
  <script>
    async function getFungibleVerifiedTokens(requested_page, total_rows) {
      try {
        fungible_verified_tokens = document.getElementById('fungible_verified_tokens');
        url = '/ajax_account_tokens/{{net}}/fungible-verified/{{instance_address}}/'+ requested_page + '/' + total_rows + '/' + api_key;
        
        fungible_verified_tokens.innerHTML = '{% include "base/spinner.html" %}'
        await fetch(url)
          .then((response) => {
            return response.text();
          })
          .then((data) => {
            fungible_verified_tokens.innerHTML = data;
          })
          .catch(function (error) {
            console.log(error);
          });
      }
    catch (error) {
      
  }
    }
  
    function prev_f_v_tokens(requested_page, total_rows) {
      getFungibleVerifiedTokens(requested_page, total_rows)
    };
    function next_f_v_tokens(requested_page, total_rows) {
      getFungibleVerifiedTokens(requested_page, total_rows)
    };
  
  
    async function getNonFungibleVerifiedTokens(requested_page, total_rows) {
      try {
        non_fungible_verified_tokens = document.getElementById('non_fungible_verified_tokens');
        url = '/ajax_account_tokens/{{net}}/non-fungible-verified/{{instance_address}}/'+ requested_page + '/' + total_rows + '/' + api_key;
        
        non_fungible_verified_tokens.innerHTML = '{% include "base/spinner.html" %}'
        await fetch(url)
          .then((response) => {
            return response.text();
          })
          .then((data) => {
            non_fungible_verified_tokens.innerHTML = data;
          })
          .catch(function (error) {
            console.log(error);
          });
      }
    catch (error) {
      
  }
    }
  
    function prev_n_f_v_tokens(requested_page, total_rows) {
      getNonFungibleVerifiedTokens(requested_page, total_rows)
    };
    function next_n_f_v_tokens(requested_page, total_rows) {
      getNonFungibleVerifiedTokens(requested_page, total_rows)
    };
  
    
    async function getUnVerifiedTokens(requested_page, total_rows) {
      try {
        unverified_tokens = document.getElementById('unverified_tokens');
        url = '/ajax_account_tokens/{{net}}/unverified/{{instance_address}}/' + requested_page + '/' + total_rows + '/' + api_key;
        
        unverified_tokens.innerHTML = '{% include "base/spinner.html" %}'
        await fetch(url)
          .then((response) => {
            return response.text();
          })
          .then((data) => {
            unverified_tokens.innerHTML = data;
          })
          .catch(function (error) {
            console.log(error);
          });
      }
    catch (error) {
      
  }
    }
  
    function prev_un_tokens(requested_page, total_rows) {
      getUnVerifiedTokens(requested_page, total_rows)
    };
    function next_un_tokens(requested_page, total_rows) {
      getUnVerifiedTokens(requested_page, total_rows)
    };
  
  </script>


<script>
    async function getTransactions(requested_page, total_rows) {
        transactions = document.getElementById('instance-transactions');
        url =  '/ajax_instance_txs_html_v2/{{net}}/{{index}}/{{subindex}}/' + requested_page + '/' + total_rows + '/' + api_key;
        transactions.innerHTML = '{% include "base/spinner.html" %}'
        await fetch(url)
            .then((response) => {
                return response.text();
            })
            .then((data) => {
                transactions.innerHTML = data;
            })
            .catch(function (error) {
                console.log(error);
            });
    }

    function prev_txs(requested_page, total_rows) {
        console.log("___PREV:", requested_page)
        getTransactions(requested_page, total_rows)
    };
    function next_txs(requested_page, total_rows) {
        console.log("___NEXT:", requested_page)
        getTransactions(requested_page, total_rows)
    };
    window.addEventListener('load', (event) => {
        getTransactions(0, 0);

    });
</script>
<script>
    function Track() {
        cis6 = document.getElementById('cis6_tracker');
        item_id = document.getElementById("item_id").value;
        url = '/ajax_track_item_id/{{net}}/{{index}}/{{subindex}}/'+item_id;
        cis6.innerHTML = '{% include "base/spinner.html" %}'
        fetch(url)
        .then((response) => {
            return response.text();
        })
        .then((data) => {
            cis6.innerHTML = data;
        })
        .catch(function (error) {
            console.log(error);
        });
    
  };
</script>


{% if error %}
<div class="row">
  <div class=" col-lg-12 ">
      <p class="bg-danger-subtle border curved-border">{{error.errorMessage}}</p>
  </div>
</div>

{% else %}
  {% if contract.v0 %}
      {% set details = contract.v0 %}
  {%else%}
      {% set details = contract.v1 %}
  {% endif %}

  {% include 'base/search_bar_non_home_inclusion.html' %}
  <div class="row  mt-4">
      <div class="col">{% include 'smart_contracts/instance_header.html' %}</div>  
  </div>
  <!-- https://codepen.io/ondrejsvestka/pen/gWPpPo for equal height columns -->
  <div class="row mt-4 row-flex">
      {% if supports_cis6 %}<div class="col-md-6  col-sm-12 ">{%else%}<div class=" col-md-8  col-sm-12">{%endif%}
          
          <div class="border content curved-border " >
              {% set title= "Contract Info" %}{% include 'base/box_title.html' %}
              {% include "smart_contracts/smart_instance_info.html" %}</div>
      </div>
    
      {% if supports_cis6 %}
      <div class="col-md-6  col-sm-12">
        <div class="border content curved-border " >
          {% set title= "Track & Track Info" %}{% include 'base/box_title.html' %}
          <a class="" href="{{filename}}" title="Download .csv file for all items" target="_blank">Download .csv file</a> for all items<br/> or<br/>
          <label for="item_id">Track individual item</label>
              <select name="item_id" id="item_id" class=" form-select form-select-sm small">
                  
                  {% for item_id in item_ids %}
                    <option value="{{item_id}}">{{item_id}}</option>
                  {% endfor %}
                  
                </select> 
                <br/>
                
                <button onclick='Track()' type="button" id="track-button" class=" ms-4 pe-3 btn btn-sm btn-primary">Track Item</button>
                
              
                <div id="cis6_tracker"></div>
          </div>
      </div>
      {% endif %}
      
    </div>
    
    <div class="row row-flex">
      {% if tokens_available %}
          
            <div id="fungible_verified_tokens"></div>
          
          
            <div id="non_fungible_verified_tokens"></div>
          
          
            <div id="unverified_tokens"></div>
          
        </div>  
    
        
      
      {% endif %}
      {% if supports_cis6 %}<div class="col-md-6  col-sm-12 ">{%else%}<div class=" col-md-8  col-sm-12">{%endif%}
          <div class="border content curved-border " >
              <div id="instance-transactions"></div>
              
      </div>
      </div>
    </div>

    <div class="row row-flex">
      <div class="col-md-12  col-sm-12">
          <div class="border content curved-border " >
            {% set title= "Module Build Info" %}{% include 'base/box_title.html' %}
            {% include "smart_contracts/smart_module_build_info.html" %}
      
        </div>
      </div>
      
    </div>
    {% if module %}
        {% set v = module.verification %}
    {% else %}
        {% set v = contract.module_verification %}
    {% endif %}
    {%if v.verified%}
  <div class="row row-flex">
    <div class="col-md-12  col-sm-12">
        <div class="border content curved-border " >
          {% set title= "Module Source Code" %}{% set copy_source=True %}{% include 'base/box_title.html' %} 
    
          {% include "smart_contracts/smart_module_source.html" %}
    
      </div>
    </div>
    
  </div>
  {% endif %}

  {% endif %}  
  <script>
    window.addEventListener('load', (event) => {
        getFungibleVerifiedTokens(0, 0);
        getNonFungibleVerifiedTokens(0,0);
        getUnVerifiedTokens(0,0);
      });
        
    </script>
{% endblock content %}